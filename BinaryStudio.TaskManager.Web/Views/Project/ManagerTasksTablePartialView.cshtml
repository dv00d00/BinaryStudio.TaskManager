@model BinaryStudio.TaskManager.Web.Models.TaskViewModel
<link href="../../Content/themes/base/jquery.ui.all.css" rel="stylesheet" type="text/css" />
<script src="../../Scripts/PopupDialog.js" type="text/javascript"></script>
@* This partial view draw a task block in table *@
@{ string divClass = "pr" + Model.Task.Priority.ToString();
   string[] pClass = { "priorityLow", "priorityMiddle", "priorityHigh", "blocking" };
    <div class ="task"  id = @Model.Task.Id.ToString() style="position: relative;">
        <p class= "@pClass[@Model.Task.Priority].ToString()" style="text-overflow: clip; border-radius: 13px 13px 0px 0px; font-size: 10pt; margin-top: 0.5px ;margin-bottom: 4px; height: 20px; padding-top: 5px;">
            <a href="@Url.Action("Edit", "Project", new { taskId = @Model.Task.Id, projectId = @Model.Task.ProjectId, viewStyle = @Model.ViewStyle })">
                <i class= "icon-edit" style="position: absolute; left: 15px;" title="edit task"></i>
            </a>
            @Model.TaskName
            <a data-toggle="modal" data-id="@Model.Task.Id" data-projectid="@Model.Task.ProjectId" class="openDeleteTask" href="#deleteTask">
                <i class= "icon-remove" style="position: absolute; right: 15px" title="delete task"></i>
            </a>
        </p>
        <div style="overflow: hidden; margin: 5px">
            @Model.Task.Description
        </div>
        <br />
        <div>
            <a href="@Url.Action("Details", "Project", new { id = @Model.Task.Id, viewStyle = @Model.ViewStyle })" style="position: absolute; bottom:0px; left: 15px; font-size: 9pt;" >
                <img height="20" width="20" style="padding-bottom: 4px;" src=@Url.Content("~/Content/images/details.png")/>
                details </a>
            @if (Model.Task.AssigneeId.HasValue)
            {
                if (Model.Task.Closed == (DateTime?)null)
                {
                    <a  class="done" id="@Model.Task.Id" style="position: absolute; bottom: 0px; left: 110px; font-size: 9pt; cursor: pointer;" >
                        <img height="18" width="18" style="padding-bottom: 4px;" src=@Url.Content("~/Content/images/done.png")/>
                        done </a>
                }
                else
                {
                    <p style="position: absolute; bottom: 0px; left: 90px; font-size: 9pt; margin: 0 0 7px;">
                        closed:@Model.Task.Closed.Value.ToShortDateString()
                    </p>
                }
            }
        </div>
    </div>
}

<div class="modal hide" id="deleteTask">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">×</button>
        <h3>Delete task</h3>
    </div>
    <div class="modal-body">
    </div>
    <div class="modal-footer">
        @*@if (Model.ViewStyle == true)
        {
            <span class="divider-vertical"></span>
            @Html.ActionLink("Return to project", "MultiuserView", new { projectId = Model.Task.ProjectId, viewStyle = true }, new { @class = "btn" })
        }
        else
        {
            <span class="divider-vertical"></span>
            @Html.ActionLink("Back to project dashboard", "Project", new { id = Model.Task.ProjectId }, new { @class = "btn" })
        }*@
        <h3 align="center">
            Are you sure you want to delete this task?<br/>
            <button title="Yes" class="yes btn btn-success" id="TaskId" name="TaskId" projectid="projectid">
                Yes
            </button>
            <span class="divider-vertical"></span>
            @Html.ActionLink("Back to project dashboard", "Project", new { id = Model.Task.ProjectId }, new { @class = "btn btn-danger" })
        </h3>
    </div>
</div>

<script type="text/javascript">
    $(document).on("click", ".openDeleteTask",
        function() {
            var onSuccess = function() {
                $('#deleteTask').modal('show');
            };
            var name = $(this).data('id');
            $(".modal-footer #TaskId").val(name);
            var projectId = $(this).data('projectid');
            $(".modal-footer #projectid").val(projectId);
            $(".modal-body").load(
                "/Project/Delete/" + name ,
                { idTask: name },
                onSuccess
            );
        });

        $(document).ready(function () {

            $(".delete").prop("disabled", true);

            $(".yes").click(function () {
                var id = $(this).attr('id');
                var projId = $(this).attr('projectid');
                $.ajax({
                    type: "POST",
                    url: "/Project/DeleteConfirmed/",
                    data: { idTask: id, projectId: projId },
                    dataType: "json",
                    traditional: true
                });
            });

            $(".no").click(function () {
                $(".delete").prop("disabled", true);
            });

        });
        
//        $(document).on("click", ".openDeleteTask", function () {
//            var name = $(this).data('id');
//            $(".modal-body #TaskName").val(name);
//            $('#deleteTask').modal('show');
//        });
</script>