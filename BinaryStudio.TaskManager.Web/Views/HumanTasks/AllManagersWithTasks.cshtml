@model BinaryStudio.TaskManager.Web.Models.ManagersViewModel


<script type="text/javascript">
    $(document).ready(function () {
        var senderId, taskId, receiverId;

        $(".sortableTasks").sortable({
            start: function (event, ui) {
                senderId = $(this).closest(".managerTasks").attr("id");
            },
            receive: function (event, ui) {
                receiverId = $(this).closest(".managerTasks").attr("id");
                taskId = $(ui.item).attr("id");
                
                var stringArray = new Array();
                stringArray[0] = taskId;
                //check, mb sender or receiver are unassigned 
                stringArray[1] = (typeof senderId == "undefined") ? -1 : senderId;
                stringArray[2] = (typeof receiverId == "undefined") ? -1 : receiverId;
                                
                //alert(stringArray[0] + stringArray[1] + stringArray[2]);
                $.ajax({
                    type: "POST",
                    url: "/HumanTasks/MoveTask",
                    data: { taskId: stringArray[0], senderId: stringArray[1], receiverId: stringArray[2] },
                    dataType: "json",
                    traditional: true
                });
            },
            connectWith: $(".sortableTasks"),
            placeholder: "placeholderTask",
            cursor: 'move'
        });
        $(".sortableTasks").disableSelection();
    });
</script>


<!-- Caption of the table "Managers-Tasks"-->
<p align="center">Менеджеры и их текущие задачи.</p>
<table align="center">            
   
    @if (Model.ManagerTasks.Count == 0)
    {
        <p>Менеджеры не найдены!</p>
    }
    else
    {
        <!-- Header of the table (Managers names)-->
        <tr>
            <td align="center" width="250">
                    <div class="manager">Нераспределенные задачи </div>
                </td>
            @foreach (var manager in Model.ManagerTasks)
            {
                <td align="center" width="250">
                   
                    <div class="manager" >
                         @Html.ActionLink(manager.Manager.Name, "ManagerDetails",new {managerId = manager.Manager.Id})
                         
                    </div>
                </td>
            }
        </tr>
    }
            
    <!-- Create a column with tasks-->
    <td align = "center" valign="top" width="250">
         <div>@Html.ActionLink("Добавить новую нераспределенную задачу", "Create", new {managerId = -1})</div>
        @foreach (var unAssignedTask in Model.UnAssignedTasks)
        {
            <div class="sortableTasks">        
                @Html.Partial("ManagerTasksTablePartialView", unAssignedTask)
            </div>
        }
        <div class = "sortableTasks" style = "height: 300px"></div>
    </td>
        
    
    @foreach (var manager in Model.ManagerTasks)
    {        
        <td id=@manager.Manager.Id.ToString() align = "center" valign="top" width="250" class="managerTasks">
                 <div>@Html.ActionLink("Добавить задачу", "Create", new {managerId = manager.Manager.Id})</div>
                @foreach (var task in manager.Tasks.OrderByDescending(x => x.Priority))
                {
                    <div class="sortableTasks" >
                        @Html.Partial("ManagerTasksTablePartialView", task)                    
                   </div>
                }
            <div class = "sortableTasks" style = "height: 300px"></div>
        </td>
    }    
</table>